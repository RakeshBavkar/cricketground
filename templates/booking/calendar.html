{% extends 'base/base.html' %}
{% block content  %}
<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ground Booking Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/calendar.css' %}">
    <style>
        .booked {
            background-color: green !important;
            color: white;
            font-weight: bold;
            border-radius: 5px;
            padding: 5px;
        }
        .legend {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            font-weight: bold;
        }
        .legend-box {
            width: 20px;
            height: 20px;
            display: inline-block;
            border-radius: 3px;
        }
        .green-box {
            background-color: green;
        }
    </style>
</head>
<body>
<div class="container-fluid mt-3">
    <div class="date">
        <button id="prevMonth" class="btn btn-secondary">&lt;</button>
        <h3 class="text-center">Ground Booking Status</h3>
        <button id="nextMonth" class="btn btn-secondary">&gt;</button>
    </div>

    <div class="weekdays"></div>
    <div class="days"></div>

    <!-- ðŸ”¥ Added Legend Below the Calendar -->
    <div class="legend">
        <span class="legend-box green-box"></span> <span>Booked Dates</span>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const daysContainer = document.querySelector(".days");
        const weekdaysContainer = document.querySelector(".weekdays");
        const dateDisplay = document.querySelector(".text-center");

        let currentDate = new Date();
        const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        // Parse JSON data from Django
        const bookedDates = JSON.parse('{{ ground_records_json|safe }}');

        function renderWeekdays() {
            weekdaysContainer.innerHTML = "";
            weekdays.forEach((day) => {
                const weekday = document.createElement("div");
                weekday.textContent = day;
                weekday.classList.add("day");
                weekdaysContainer.appendChild(weekday);
            });
        }

        function renderCalendar() {
            daysContainer.innerHTML = "";
            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();

            dateDisplay.textContent = `${currentDate.toLocaleString("default", { month: "long" })} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement("div");
                emptyDay.classList.add("number-pre");
                daysContainer.appendChild(emptyDay);
            }

            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement("div");
                day.textContent = i;
                day.classList.add("number");

                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                
                // Check if this date is in the booked list
                if (bookedDates.includes(dateStr)) {
                    day.classList.add("booked");
                }

                daysContainer.appendChild(day);
            }
        }

        document.getElementById("prevMonth").addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById("nextMonth").addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        renderWeekdays();
        renderCalendar();
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
{% endblock %}
